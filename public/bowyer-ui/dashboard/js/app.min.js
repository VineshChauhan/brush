var bowyerApp;!function(){"use strict";bowyerApp=angular.module("bowyer",["ngAnimate","ngCookies","ngTouch","ngSanitize","ui.router","ui.bootstrap","LocalStorageModule"])}(),function(){"use strict";var e=["$stateProvider","$urlRouterProvider","localStorageServiceProvider","$httpProvider",function(e,r,t,o){e.state("login",{url:"/login",templateUrl:"bowyer-ui/dashboard/partials/login/login.html",controller:"loginCtrl",controllerAs:"login"}).state("logout",{url:"/logout",controller:"logoutCtrl",controllerAs:"logout"}).state("forgotPassword",{url:"/forgotPassword",templateUrl:"bowyer-ui/dashboard/partials/forgotPassword/forgotPassword.html",controller:"forgotPasswordCtrl",controllerAs:"forgotPassword"}).state("register",{url:"/register",templateUrl:"bowyer-ui/dashboard/partials/register/register.html",controller:"registerCtrl",controllerAs:"register"}).state("dashboard",{url:"/",templateUrl:"bowyer-ui/dashboard/partials/dashboard/dashboard.html",controller:"dashboardCtrl",controllerAs:"dashboard"}).state("dashboard.alerts",{url:"alerts",templateUrl:"bowyer-ui/dashboard/partials/dashboard/alerts/alerts.html"}).state("dashboard.users",{url:"users",controller:"usersCtrl",controllerAs:"users",templateUrl:"bowyer-ui/dashboard/partials/dashboard/users/users.html"}).state("dashboard.profile",{url:"profile",templateUrl:"bowyer-ui/dashboard/partials/dashboard/profile/profile.html",controller:"profileCtrl",controllerAs:"profile"}).state("dashboard.resetPassword",{url:"resetPassword",templateUrl:"bowyer-ui/dashboard/partials/dashboard/resetPassword/resetPassword.html",controller:"resetPasswordCtrl",controllerAs:"resetPassword"}).state("dashboard.api",{url:"api",templateUrl:"bowyer-ui/dashboard/partials/dashboard/api/api.html"}).state("dashboard.config",{url:"config",templateUrl:"bowyer-ui/dashboard/partials/dashboard/config/config.html",controller:"configCtrl",controllerAs:"config"}).state("dashboard.config.roles",{url:"/roles",templateUrl:"bowyer-ui/dashboard/partials/dashboard/config/roles/roles.html",controller:"rolesCtrl",controllerAs:"roles"}).state("dashboard.healthcheck",{url:"healthcheck",templateUrl:"bowyer-ui/dashboard/partials/dashboard/healthcheck/healthcheck.html",controller:"healthCheckCtrl as vm"}),r.otherwise("/login"),t.setPrefix("bowyer"),o.interceptors.push("tokenInjector")}];bowyerApp.config(e)}(),function(){"use strict";var e=["$http","$rootScope","$state","localStorageService","$uibModalStack",function(e,r,t,o,a){r.$on("$stateChangeStart",function(e,r,s,l,n,i){"login"!==r.name&&(o.get("user")||t.go("login")),a.dismissAll()})}];bowyerApp.run(e)}(),function(){"use strict";bowyerApp.controller("dashboardCtrl",["commonFactory","$state",function(e,r){var t=this;t.user=e.getUser(),t.user||r.go("login")}])}(),function(){"use strict";bowyerApp.controller("forgotPasswordCtrl",["api","url","constants",function(e,r,t){var o=this;o.validateAndSendMeLink=function(){var a={url:r.forgotPassword,data:{username:o.username},method:t.method.post};e.executeCall(a,function(e){o.forgotPasswordError=e.data,o.username=""},function(e){o.error=e.data})}}])}(),function(){"use strict";bowyerApp.controller("loginCtrl",["api","$state","$stateParams","localStorageService","loginFactory",function(e,r,t,o,a){var s=this;s.loginError=a.logoutMessage,s.validateLogin=function(){s.error={},s.loginError=!1,e.executeCall(a.login(s),function(e){e.data.api_token?(o.set("user",e.data),r.go("dashboard")):s.loginError=e.data.message},function(e){s.error=e.data})}}])}(),function(){"use strict";bowyerApp.factory("loginFactory",["constants","url",function(e,r){return{login:function(t){return{url:r.login,data:{username:t.username,password:t.password},method:e.method.post}},logout:function(){return{url:r.logout}}}}])}(),function(){"use strict";bowyerApp.controller("logoutCtrl",["api","$state","loginFactory","localStorageService","constants",function(e,r,t,o,a){e.executeCall(t.logout(),function(e){t.logoutMessage=a.logoutMessages.regularLogout,o.clearAll(),r.go("login")})}])}(),function(){"use strict";bowyerApp.controller("registerCtrl",["api","$state","localStorageService","constants","url",function(e,r,t,o,a){var s=this;s.validateRegister=function(r){if(s.registerError=!1,s.formData){var t={url:a.register,data:{username:s.formData.username,email:s.formData.email,password:s.formData.password,name:""},method:o.method.post};e.executeCall(t,function(e){e.data.user_id?(s.registerError={message:"User has been created.",type:"success"},s.formData={}):s.registerError=e.data},function(e){s.error=e.data})}else s.error={username:!0,email:!0,password:!0}}}])}(),function(){"use strict";bowyerApp.factory("api",["$http","constants","$state","localStorageService","loginFactory",function(e,r,t,o,a){var s=function(e){o.clearAll(),a.logoutMessage=r.logoutMessages.loggedoutDueError[e.status],t.go("login")},l=function(e,r){401===e.status?s(e):r?r(e):s(e)};return{executeCall:function(t,o,a){return t.method===r.method.post?e.post(t.url,t.data).then(o,function(e){l(e,a)}):t.method===r.method["delete"]?e["delete"](t.url).then(o,function(e){l(e,a)}):e.get(t.url).then(o,function(e){l(e,a)})}}}])}(),function(){"use strict";bowyerApp.factory("commonFactory",["api","localStorageService","url",function(e,r,t){var o=function(r,t){e.executeCall(r,t)};return{getRoles:function(e){o({url:t.reference.roles},e)},getAdminRoles:function(e){o({url:t.admin.roles},e)},getUser:function(){return r.get("user")}}}])}(),function(){"use strict";bowyerApp.factory("constants",[function(){return{method:{post:"POST","delete":"DELETE",get:"GET"},logoutMessages:{regularLogout:"You have logout successfully.",loggedoutDueError:{401:"You are not authorize to access. Please contact support.",500:"System error. Please contact support.",404:"Resource not found. Please contact support."}}}}])}(),function(){"use strict";bowyerApp.factory("tokenInjector",["localStorageService",function(e){var r={request:function(r){return e.get("user")&&(r.headers.apitoken=e.get("user").api_token),r}};return r}])}(),function(){"use strict";bowyerApp.factory("url",[function(){return{login:"/api/login",logout:"/api/logout",register:"/api/register",forgotPassword:"/api/forgotPassword",reference:{roles:"/api/reference/roles"},admin:{addUser:"/api/admin/addUser",users:"/api/admin/users",user:"/api/admin/user/",updateUser:"/api/admin/updateUser",apiHealthCheck:"/api/healthCheck/apiCheck",dbHealthCheck:"/api/healthCheck/dbCheck",roles:"api/admin/roles"},user:{me:"/api/user/me",resetPassword:"/api/user/resetPassword"}}}])}(),function(){"use strict";bowyerApp.controller("configCtrl",["$scope",function(e){}])}(),function(){"use strict";bowyerApp.controller("healthCheckCtrl",["api","localStorageService","healthCheckFactory",function(e,r,t){var o=this;o.api=t.initial,o.db=t.initial,o.ls=t.initial,e.executeCall(t.apiCheckConfig,function(e){o.api=t.success},function(){o.api=t.failed}),e.executeCall(t.dbCheckConfig,function(e){o.db=t.success,e.data.api_token===r.get("user").api_token?o.ls=t.success:o.ls=t.failed},function(){o.db=t.failed,o.ls=t.failed})}])}(),function(){"use strict";bowyerApp.factory("healthCheckFactory",["url",function(e){return{initial:{checkValue:0,checkMessage:"checking ...",type:"warning"},success:{checkValue:100,checkMessage:"Healthy",checkPass:!0,type:"success"},failed:{checkValue:100,checkMessage:"Failed",type:"danger"},apiCheckConfig:{url:e.admin.apiHealthCheck},dbCheckConfig:{url:e.admin.dbHealthCheck}}}])}(),function(){"use strict";bowyerApp.controller("profileCtrl",["api","constants","commonFactory","url","localStorageService",function(e,r,t,o,a){var s=this,l={url:o.user.me};e.executeCall(l,function(e){s.user=e.data}),s.validateAndSave=function(){l.method=r.method.post,l.data=s.user,e.executeCall(l,function(e){e.data.user_id&&(a.set("user",e.data),s.profileError={type:"success",message:"Profile updated successfully."})},function(e){s.error=e.data})}}])}(),function(){"use strict";bowyerApp.controller("resetPasswordCtrl",["api","constants","url",function(e,r,t){var o=this;o.validateAndSave=function(){if(o.error={},o.formData)if(o.formData.newPassword&&""!==o.formData.newPassword&&o.formData.newPassword===o.formData.confirmPassword){var a={url:t.user.resetPassword,method:r.method.post,data:o.formData};e.executeCall(a,function(e){o.resetPasswordError=e.data,"success"===o.resetPasswordError.type?o.formData={}:o.error.password=!0},function(e){o.error=e.data})}else o.error={newPassword:!0,confirmPassword:!0};else o.error={password:!0,newPassword:!0,confirmPassword:!0}}}])}(),function(){"use strict";bowyerApp.controller("usersCtrl",["api","constants","$uibModal","url",function(e,r,t,o){var a=this,s={url:o.admin.users};e.executeCall(s,function(e){a.users=e.data}),a.deleteUser=function(t){t.deleteInitiated=!0;var a={url:o.admin.user+t.user_id,method:r.method["delete"]};e.executeCall(a,function(e){"success"===e.data.type&&(t.deleted="Y")})},a.editUser=function(e){var r=t.open({templateUrl:"bowyer-ui/dashboard/partials/dashboard/users/addEditUser/addEditUser.html",controller:"addEditUserCtrl",controllerAs:"addEditUser",resolve:{config:function(){return e?{title:"Edit User",user:e,type:"edit"}:{title:"Add User",type:"add"}}}});r.result.then(function(e){"add"===e.config.type&&a.users.push(e.user)},function(){})}}])}(),function(){"use strict";bowyerApp.directive("bowyerLogo",function(){return{restrict:"EA",template:'<span>bow</span><span style="color:#F39C12">yer</span>'}})}(),function(){"use strict";bowyerApp.controller("rolesCtrl",["api","commonFactory",function(e,r){var t=this;r.getAdminRoles(function(e){t.roles=e.data})}])}(),function(){"use strict";bowyerApp.controller("addEditUserCtrl",["$uibModalInstance","api","constants","commonFactory","config","url",function(e,r,t,o,a,s){var l=this;o.getRoles(function(e){l.roles=e.data}),l.config=a,l.user=a.user;var n={url:s.admin.updateUser};l.validateAndSave=function(){"add"===l.config.type&&(n.url=s.admin.addUser),n.method=t.method.post,n.data=l.user,r.executeCall(n,function(r){r.data.user_id?(l.user=r.data,e.close(l)):l.addEditUserError=r.data},function(e){l.error=e.data})},l.cancel=function(){e.dismiss("cancel")}}])}();